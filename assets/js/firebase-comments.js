function initCommentSystem(e){const t=e.querySelector(".fc-comments"),n=e.querySelector(".fc-error-message"),s=e.querySelector(".fc-message"),o=e.querySelector(".fc-info-message"),a=e.querySelector("#fc-sendBtn"),c=e.querySelector("#fc-commentText"),r=e.querySelector("#fc-nickname");let i,m;a&&(i=a.querySelector(".fc-spinner"),m=a.querySelector("span"));const l={apiKey:"AIzaSyDx101DUQr-LvhW8K7woVJ58_a74TkkgJM",authDomain:"ucbgcomment.firebaseapp.com",projectId:"ucbgcomment",storageBucket:"ucbgcomment.appspot.com",messagingSenderId:"1006694508007",appId:"1:1006694508007:web:9f3a4413dbdeacfeee0942"};firebase.apps.length||firebase.initializeApp(l);const d=firebase.firestore(),f=window.location.pathname.replace(/\/$/,"")||"/";let u=!1;function loadComments(){u=!0,o.style.display="block",o.textContent="Loading comments...",o.className="fc-message fc-info-message";d.collection("comments").where("page","==",f).orderBy("date","desc").onSnapshot(e=>{if(u=!1,o.style.display="none",e.empty)return void(t.innerHTML='<div class="fc-no-comments">No comments yet. Be the first to comment!</div>');let n="";e.forEach(e=>{const t=e.data(),s=t.date.toDate?t.date.toDate():t.date;n+=`\n              <div class="fc-comment">\n                <div class="fc-comment-header-inner">\n                  <span class="fc-comment-author">${t.nickname||"Anonymous"}</span>\n                  <span class="fc-comment-date">${function formatDate(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}(s)}</span>\n                </div>\n                <div class="fc-comment-content">${t.text}</div>\n              </div>\n            `}),t.innerHTML=n},e=>{console.error("Error loading comments:",e),u=!1,o.textContent="Error loading comments. Please try again.",o.className="fc-message fc-error-message",o.style.display="block"})}function validateForm(){let e=!0;return s&&(s.textContent="",s.style.display="none"),c.value.trim()?n.style.display="none":(n.textContent="Please write your comment",n.style.display="block",e=!1),a&&(a.disabled=!e),e}a&&a.addEventListener("click",async()=>{if(!validateForm())return;const e=r.value.trim(),t=c.value.trim();a.disabled=!0,i.style.display="block",m.textContent="Submitting...",s&&(s.textContent="",s.style.display="none");try{const n=await fetch("https://addcomment-rfkgsqj4ya-uc.a.run.app",{method:"POST",headers:{"Content-Type":"application/json",Origin:"https://uwbg.github.io"},body:JSON.stringify({pageId:f,nickname:e,text:t}),mode:"cors"}),o=await n.text();let a;try{a=JSON.parse(o)}catch(e){throw console.error("JSON parse error:",e,"Response:",o),new Error(`Invalid server response: ${o.substring(0,100)}`)}if(n.ok&&a.success)c.value="",s&&(s.textContent="âœ“ Comment submitted successfully!",s.className="fc-message fc-success-message",s.style.display="block"),loadComments(),setTimeout(()=>{s&&(s.style.display="none")},3e3);else{const e=a.error||`HTTP Error: ${n.status}`;s&&(s.textContent="Error: "+e,s.className="fc-message fc-error-message",s.style.display="block")}}catch(e){console.error("Submission error:",e),s&&(s.textContent="Error: "+(e.message||"Could not connect to server"),s.className="fc-message fc-error-message",s.style.display="block")}finally{a&&(a.disabled=!1),i&&(i.style.display="none"),m&&(m.textContent="Submit Comment")}}),c&&c.addEventListener("input",validateForm),r&&r.addEventListener("input",validateForm),loadComments(),setTimeout(validateForm,100)}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".firebaseComment");0!==e.length&&e.forEach(e=>{e.innerHTML='\n        <div class="fc-comment-header">\n          <h2><i class="fas fa-comments"></i> Comments</h2>\n        </div>\n        \n        <div class="fc-comments-container">\n          <div class="fc-comments">Loading comments...</div>\n          <div class="fc-info-message">Loading comments...</div>\n        </div>\n        \n        <div class="fc-comment-form">\n          <h2><i class="fas fa-pen"></i> Add a Comment</h2>\n          <div class="fc-form-group">\n            <label for="fc-nickname">Nickname (optional)</label>\n            <input type="text" id="fc-nickname" placeholder="Your name or nickname">\n          </div>\n          \n          <div class="fc-form-group">\n            <label for="fc-commentText">Your Comment <span style="color:var(--fc-error-color)">*</span></label>\n            <textarea id="fc-commentText" placeholder="Write your thoughts here..." required></textarea>\n            <div class="fc-error-message">Please write your comment</div>\n          </div>\n          \n          <button id="fc-sendBtn">\n            <div class="fc-spinner"></div>\n            <span>Submit Comment</span>\n          </button>\n          <div class="fc-message"></div>\n        </div>\n      ',initCommentSystem(e)})});